# Author: Max Stoddard
services:
  - type: web
    runtime: static
    name: uk-housing-market-abm
    branch: master
    autoDeployTrigger: checksPass
    rootDir: dashboard
    buildCommand: npm ci --include=dev && npm run build
    staticPublishPath: dist
    envVars:
      - key: VITE_API_BASE_URL
        value: https://uk-housing-market-abm-api.onrender.com
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    buildFilter:
      paths:
        - dashboard/src/**
        - dashboard/shared/**
        - dashboard/package.json
        - dashboard/package-lock.json
        - dashboard/vite.config.ts
        - dashboard/index.html

  - type: web
    # Docker runtime is required for remote model runs because the API invokes Maven/Java.
    runtime: docker
    name: uk-housing-market-abm-api
    plan: free
    branch: master
    autoDeployTrigger: checksPass
    dockerfilePath: dashboard/Dockerfile.api
    dockerContext: .
    healthCheckPath: /healthz
    envVars:
      - key: DASHBOARD_CORS_ORIGIN
        value: https://uk-housing-market-abm.onrender.com
      - key: DASHBOARD_ENABLE_MODEL_RUNS
        value: "true"
      - key: DASHBOARD_GIT_STATS_BASE_COMMIT
        value: 4e89f5e277cdba4b4ef0c08254e5731e19bd51c3
      - key: DASHBOARD_GITHUB_REPO
        value: max-stoddard/UK-Housing-Market-ABM
      - key: DASHBOARD_GITHUB_BRANCH
        value: master
      - key: DASHBOARD_GITHUB_TOKEN
        sync: false
      - key: DASHBOARD_WRITE_USERNAME
        sync: false
      - key: DASHBOARD_WRITE_PASSWORD
        sync: false
    buildFilter:
      paths:
        - dashboard/Dockerfile.api
        - dashboard/server/**
        - dashboard/shared/**
        - dashboard/package.json
        - dashboard/package-lock.json
        - pom.xml
        - src/**
        - input-data-versions/**
        - render.yaml
